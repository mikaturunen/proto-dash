<!DOCTYPE html>

<html>
<head>
  <title>config.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <meta name="viewport" content="width=device-width, target-densitydpi=160dpi, initial-scale=1.0; maximum-scale=1.0; user-scalable=0;">
  <link rel="stylesheet" media="all" href="../docco.css" />
</head>
<body>
  <div id="container">
    <div id="background"></div>
    
    <ul class="sections">
        
          <li id="title">
              <div class="annotation">
                  <h1>config.js</h1>
              </div>
          </li>
        
        
        
        <li id="section-1">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-1">&#182;</a>
              </div>
              
            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-comment">/* global console, require, __dirname, process, module */</span>
<span class="hljs-comment">/* jslint node: true */</span>
<span class="hljs-comment">/* jshint esnext: true */</span>

<span class="hljs-keyword">var</span> Q = <span class="hljs-built_in">require</span>(<span class="hljs-string">"q"</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">var</span> path = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);</pre></div></div>
            
        </li>
        
        
        <li id="section-2">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-2">&#182;</a>
              </div>
              <p>I could write fs.exists, go through the hassle of checking it and all but I thought Iâ€™d just do it this way for now,
potential refactor target in the near future.</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> config;

<span class="hljs-keyword">try</span> {
    config = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./config.json"</span>);
} <span class="hljs-keyword">catch</span> (error) {</pre></div></div>
            
        </li>
        
        
        <li id="section-3">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-3">&#182;</a>
              </div>
              <p>File not found, digest error and create dummy!
We can safely assume that when there are no configuration file in place, we use environment variables</p>

            </div>
            
            <div class="content"><div class='highlight'><pre>    config = { };
    <span class="hljs-built_in">console</span>.log(<span class="hljs-string">"Configuration not found - using environment values"</span>);
}

<span class="hljs-comment">/** 
 * Selects a value: either left-hand side or right-hand side. When LHS is undefined or "" it's skipped and RHG is used.
 * @param {string} lhs Left-hand side variable,
 * @param {string} rhg Right-hande side variable.
 * @returns {string} Lhs when it's defined and rhs otherwise.
 */</span>
<span class="hljs-keyword">var</span> selectValue = (lhs, rhs) =&gt; {
    <span class="hljs-keyword">if</span> (lhs !== <span class="hljs-literal">undefined</span> &amp;&amp; lhs.trim() !== <span class="hljs-string">""</span>) {
        <span class="hljs-keyword">return</span> lhs;
    }
    <span class="hljs-keyword">return</span> rhs;
};</pre></div></div>
            
        </li>
        
        
        <li id="section-4">
            <div class="annotation">
              
              <div class="pilwrap ">
                <a class="pilcrow" href="#section-4">&#182;</a>
              </div>
              <p>Setup all the configurations based on the environmental of configuration given variables. 
NOTE: configuration files are never populated into GitHub for more or less obvious reasons :)</p>

            </div>
            
            <div class="content"><div class='highlight'><pre><span class="hljs-keyword">var</span> configuration = {
    databaseUser:     selectValue(process.env.DATABASE_USER, config.databaseUser),
    databasePassword: selectValue(process.env.DATABASE_PASSWORD, config.databasePassword),
    databaseUrl:      selectValue(process.env.DATABASE_URL, config.databaseUrl),
    database:         selectValue(process.env.DATABASE, config.database),
    databasePort:     selectValue(process.env.DATABASE_PORT, config.databasePort)
};

<span class="hljs-built_in">module</span>.exports = configuration;</pre></div></div>
            
        </li>
        
    </ul>
  </div>
</body>
</html>
